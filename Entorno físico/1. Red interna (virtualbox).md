>[!info] Importante
>Esta es la configuración de la red interna que he utilizado durante el proyecto. No es necesario replicarla. En su día la iba a utilizar para un servidor XMPP interno que no tenía ni dominio ni proxy y algo mas. 
>He borrado muchas lineas innecesarias y para la escala del proyecto, unas IPs fijas con su dirección en `/etc/hosts` nos servirán perfectamente. 
>- **Servidor**
>```
># archivo /etc/hosts
>127.0.0.1       master.javier.lan
127.0.0.1       ldap.javier.lan
10.0.2.1        vm1.javier.lan
10.0.2.2        vm2.javier.lan
10.0.2.3        vm3.javier.lan
10.0.2.4        vm4.javier.lan
>```
>- **En cualquier cliente**
>```
127.0.0.1       localhost
127.0.1.1       vm1.javier.lan
10.0.2.253      ldap.javier.lan
10.0.2.253      master.javier.lan
>```
> Podemos añadir cuantos huéspedes queramos.  

## DHCP

```
apt-get install isc-dhcp-server -y
```
```
vim /etc/dhcp/dhcpd.conf
```
```
subnet 10.0.2.0 netmask 255.255.255.0 {
  range 10.0.2.1 10.0.2.10;
  option domain-name-servers 10.0.2.253, 8.8.4.4;
  option routers 10.0.2.254;
}

host vm1 {
    hardware ethernet 08:00:27:2a:72:ac;
    fixed-address 10.0.2.1;
}

host vm2 {
    hardware ethernet 08:00:27:fa:7c:61;
    fixed-address 10.0.2.2;
}
```


```
vim /etc/default/isc-dhcp-server
```
```
INTERFACESv4="enp0s8"
```

```
systemctl restart isc-dhcp-server
```

## Clientes

Al igual que nuestro servidor, todo cliente precisará de una interfaz puente y una interfaz de red interna. 

![[Pasted image 20231218132332.png]]
![[Pasted image 20231218132357.png]]

Iniciamos el equipo y configuramos las interfaces:
```
vim /etc/network/interfaces
```
```
# This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5).

source /etc/network/interfaces.d/*

# The loopback network interface
auto lo
iface lo inet loopback

# The primary network interface
allow-hotplug enp0s3
iface enp0s3 inet dhcp

allow-hotplug enp0s8
iface enp0s8 inet dhcp
```
```
systemctl restart networking
```
```
ifup enp0s3; ifup enp0s8
```

Asignamos un el nuevo `hostname` al equipo, por ejemplo a `vm1`:
```
/etc/hostname 
```
```
vm1.javier.lan
```

Comprobamos que haya obtenido su respectiva ip y servidor dns:
```
ip a 
```
```
3: enp0s8: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 08:00:27:2a:72:ac brd ff:ff:ff:ff:ff:ff
    inet 10.0.2.1/24 brd 10.0.2.255 scope global dynamic enp0s8
       valid_lft 455sec preferred_lft 455sec
```
```
cat /etc/resolv.conf
```
```
nameserver 10.0.2.253
nameserver 8.8.4.4
```
## DNS
```
apt-get install bind9
```
```bash
vim /etc/bind/named.conf.options
```
````shell
options {
	directory "/var/cache/bind";

	forwarders {
		8.8.8.8;
		8.8.4.4;
	};
	dnssec-validation auto;

	listen-on-v6 { any; };

	listen-on { 10.0.2.253; };

	querylog yes;

};
acl "trusted" {
	10.0.2.253;
	10.0.2.254;
};
````

```bash
vim /etc/bind/named.conf.local
```
````shell
// /etc/bind/named.conf.local

zone "javier.lan" {
    type master;
    file "/etc/bind/zones/db.javier.lan";  
};

zone "2.0.10.in-addr.arpa" {
    type master;
    file "/etc/bind/zones/db.10.0.2"; 
};

````

```bash
vim /etc/bind/zones/db.javier.lan
```
```shell
$TTL 1h
@ IN SOA ns1.javier.lan. admin.javier.lan. (
        2023082001 ; Serial
        3h ; Refresh
        1h ; Retry
        1w ; Expire
        1h ; Negative Cache TTL
)

@	IN	NS	ns1.javier.lan.
@	IN	A	10.0.2.253
ns1	IN	A	10.0.2.253
master  IN      A       10.0.2.253
ldap    IN      A       10.0.2.253
vm1     IN      A       10.0.2.1
vm2     IN      A       10.0.2.2
vm3     IN      A       10.0.2.3
vm4     IN      A       10.0.2.4
```

```bash
vim /etc/bind/zones/db.10.0.2
```
````bash
$TTL 1h
@ IN SOA ns1.javier.lan. admin.javier.lan. (
        2023082001 ; Serial
        3h ; Refresh
        1h ; Retry
        1w ; Expire
        1h ; Negative Cache TTL
)

@	IN	NS	ns1.javier.lan.

253	IN	PTR	ns1.javier.lan.
````

